<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackjack</title>
    <style>
        /* --- Basic Styles --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #0f3d0f; /* Dark green table color */
            color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        #game-board {
            width: 90%;
            max-width: 800px;
            background-color: #0c5c0c;
            border: 10px solid #8b4513; /* Wood border */
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            text-align: center;
        }

        h1 {
            color: #ffd700; /* Gold text */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-top: 0;
        }

        /* --- Hand & Card Styles --- */
        .hand-container {
            min-height: 150px;
            margin: 20px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        .card {
            background-color: #ffffff;
            color: #000000;
            width: 80px;
            height: 120px;
            border-radius: 8px;
            border: 1px solid #aaa;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
            margin: 5px;
            padding: 10px;
            box-sizing: border-box;
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
        }

        .card.hidden {
            background-image: repeating-linear-gradient(
                45deg,
                #6d0000,
                #6d0000 10px,
                #8b0000 10px,
                #8b0000 20px
            );
            color: transparent;
            border-color: #4a0000;
        }
        
        .card .suit {
            font-size: 2.5rem;
            line-height: 1;
        }
        
        .card.red {
            color: #ff0000;
        }

        .card .rank-top { text-align: left; }
        .card .rank-bottom { text-align: right; transform: rotate(180deg); }

        /* --- Info & Controls --- */
        #game-info {
            display: flex;
            justify-content: space-around;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        #player-money {
            color: #86ff86; /* Light green for money */
        }

        #game-message {
            font-size: 1.25rem;
            font-weight: bold;
            min-height: 1.5rem;
            margin: 15px 0;
            color: #ffd700;
        }

        .controls {
            margin-top: 20px;
            min-height: 50px;
        }

        .controls.hidden {
            display: none;
        }

        #bet-controls label {
            font-size: 1.25rem;
            margin-right: 10px;
        }

        #bet-amount {
            font-size: 1.2rem;
            width: 80px;
            padding: 5px;
            border-radius: 5px;
            border: 2px solid #ffd700;
            background: #333;
            color: #fff;
            text-align: center;
        }

        button {
            font-size: 1rem;
            font-weight: bold;
            padding: 12px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background-color: #ffd700;
            color: #333;
            transition: background-color 0.2s, transform 0.2s;
        }

        button:hover:not(:disabled) {
            background-color: #ffec80;
            transform: translateY(-2px);
        }

        button:disabled {
            background-color: #555;
            color: #999;
            cursor: not-allowed;
        }
    </style>
</head>
<body>

    <div id="game-board">
        <h1>Blackjack</h1>

        <div id="game-info">
            <span>Money: $<span id="player-money">1000</span></span>
            <button id="btn-new-game">New Game</button>
        </div>

        <div id="dealer-area">
            <h2>Dealer's Hand (<span id="dealer-score">0</span>)</h2>
            <div id="dealer-hand" class="hand-container"></div>
        </div>

        <div id="player-area">
            <h2>Your Hand (<span id="player-score">0</span>)</h2>
            <div id="player-hand" class="hand-container"></div>
        </div>

        <div id="game-message">Welcome! Place your bet to start.</div>
        
        <div id="bet-controls" class="controls">
            <label for="bet-amount">Bet:</label>
            <input type="number" id="bet-amount" value="50" min="1">
            <button id="btn-bet">Place Bet</button>
        </div>

        <div id="play-controls" class="controls hidden">
            <button id="btn-hit">Hit</button>
            <button id="btn-stand">Stand</button>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const dealerScoreEl = document.getElementById('dealer-score');
        const playerScoreEl = document.getElementById('player-score');
        const dealerHandEl = document.getElementById('dealer-hand');
        const playerHandEl = document.getElementById('player-hand');
        const gameMessageEl = document.getElementById('game-message');
        
        const btnNewGame = document.getElementById('btn-new-game');
        const btnBet = document.getElementById('btn-bet');
        const btnHit = document.getElementById('btn-hit');
        const btnStand = document.getElementById('btn-stand');
        
        const playerMoneyEl = document.getElementById('player-money');
        const betAmountEl = document.getElementById('bet-amount');
        const betControls = document.getElementById('bet-controls');
        const playControls = document.getElementById('play-controls');

        // --- Game Variables ---
        let deck = [];
        let playerHand = [];
        let dealerHand = [];
        let playerScore = 0;
        let dealerScore = 0;
        let playerAces = 0;
        let dealerAces = 0;
        let gameInProgress = false;
        let playerMoney = 1000;
        let currentBet = 0;

        // --- Suit & Rank Definitions ---
        const suits = ['Hearts', 'Diamonds', 'Clubs', 'Spades'];
        const ranks = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
        const suitSymbols = { 'Hearts': '♥', 'Diamonds': '♦', 'Clubs': '♣', 'Spades': '♠' };

        // --- Event Listeners ---
        btnNewGame.addEventListener('click', startNewGame);
        btnBet.addEventListener('click', placeBet);
        btnHit.addEventListener('click', playerHit);
        btnStand.addEventListener('click', playerStand);

        // --- Init Game ---
        window.onload = startNewGame;

        /**
         * Resets the entire game to the initial state
         */
        function startNewGame() {
            playerMoney = 1000;
            betAmountEl.value = 50;
            betAmountEl.max = playerMoney;
            gameMessageEl.textContent = 'Welcome! Place your bet to start.';
            resetForBetting();
        }
        
        /**
         * Resets the UI for a new betting round
         */
        function resetForBetting() {
            gameInProgress = false;
            currentBet = 0;
            playerHand = [];
            dealerHand = [];
            
            // Clear UI
            playerHandEl.innerHTML = '';
            dealerHandEl.innerHTML = '';
            playerScoreEl.textContent = '0';
            dealerScoreEl.textContent = '0';
            
            updateMoneyDisplay();
            betAmountEl.max = playerMoney; // Update max bet
            
            // Check for Game Over
            if (playerMoney <= 0) {
                gameMessageEl.textContent = 'Game Over! Press New Game to play again.';
                betControls.classList.add('hidden');
                playControls.classList.add('hidden');
            } else {
                gameMessageEl.textContent = 'Place your bet.';
                betControls.classList.remove('hidden');
                playControls.classList.add('hidden');
                betAmountEl.disabled = false;
                btnBet.disabled = false;
            }
        }

        /**
         * Validates and places the player's bet
         */
        function placeBet() {
            let bet = parseInt(betAmountEl.value);

            // Validate bet
            if (isNaN(bet) || bet <= 0) {
                gameMessageEl.textContent = 'Please enter a valid bet greater than 0.';
                return;
            }
            if (bet > playerMoney) {
                gameMessageEl.textContent = `You cannot bet more than $${playerMoney}.`;
                return;
            }

            // Accept bet
            currentBet = bet;
            playerMoney -= currentBet;
            updateMoneyDisplay();
            gameMessageEl.textContent = '';
            
            // Toggle controls
            betControls.classList.add('hidden');
            playControls.classList.remove('hidden');
            btnHit.disabled = false;
            btnStand.disabled = false;
            
            dealHands();
        }

        /**
         * Creates and shuffles the deck, deals hands, and checks for initial Blackjacks
         */
        function dealHands() {
            gameInProgress = true;
            createDeck();
            shuffleDeck();

            // Reset hands and scores
            playerHand = [dealCard(), dealCard()];
            dealerHand = [dealCard(), dealCard()];
            playerScore = 0;
            dealerScore = 0;
            playerAces = 0;
            dealerAces = 0;
            
            // Render initial hands (dealer's 1st card hidden)
            renderInitialHands();
            
            // Get full scores to check for Blackjack
            [playerScore, playerAces] = calculateScore(playerHand);
            [dealerScore, dealerAces] = calculateScore(dealerHand);
            
            playerScoreEl.textContent = playerScore;

            // --- Check for initial Blackjacks ---
            const playerHasBlackjack = (playerScore === 21);
            const dealerHasBlackjack = (dealerScore === 21);

            if (playerHasBlackjack || dealerHasBlackjack) {
                gameInProgress = false;
                revealDealerHand(); // Show both cards

                if (playerHasBlackjack && dealerHasBlackjack) {
                    gameMessageEl.textContent = 'Push! Both have Blackjack.';
                    playerMoney += currentBet; // Return bet
                } else if (playerHasBlackjack) {
                    gameMessageEl.textContent = 'Blackjack! You win!';
                    playerMoney += Math.floor(currentBet * 2.5); // 3:2 payout (bet + 1.5*bet)
                } else { // Dealer has Blackjack
                    gameMessageEl.textContent = 'Dealer has Blackjack! You lose.';
                    // Money was already subtracted
                }
                
                setTimeout(resetForBetting, 2500); // Wait 2.5s, then reset
            } else {
                // No Blackjacks, game continues
                gameMessageEl.textContent = 'Hit or Stand?';
            }
        }
        
        /**
         * Creates a standard 52-card deck
         */
        function createDeck() {
            deck = [];
            for (const suit of suits) {
                for (const rank of ranks) {
                    let value = parseInt(rank);
                    if (['J', 'Q', 'K'].includes(rank)) value = 10;
                    else if (rank === 'A') value = 11;
                    deck.push({ suit, rank, value });
                }
            }
        }

        /**
         * Shuffles the deck
         */
        function shuffleDeck() {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }

        function dealCard() { return deck.pop(); }

        /**
         * Renders the initial hands, with dealer's first card hidden
         */
        function renderInitialHands() {
            playerHandEl.innerHTML = '';
            dealerHandEl.innerHTML = '';
            
            // Render Player Hand
            playerHand.forEach(card => {
                playerHandEl.appendChild(createCardElement(card, false));
            });

            // Render Dealer Hand (1 hidden, 1 visible)
            dealerHandEl.appendChild(createCardElement(dealerHand[0], true)); 
            dealerHandEl.appendChild(createCardElement(dealerHand[1], false)); 
            
            // Only show the score of the visible card
            dealerScoreEl.textContent = dealerHand[1].value;
        }

        /**
         * Creates an HTML element for a card
         */
        function createCardElement(card, isHidden) {
            const cardEl = document.createElement('div');
            cardEl.classList.add('card');
            
            if (isHidden) {
                cardEl.classList.add('hidden');
            } else {
                const suit = suitSymbols[card.suit];
                const isRed = card.suit === 'Hearts' || card.suit === 'Diamonds';
                if (isRed) cardEl.classList.add('red');

                cardEl.innerHTML = `
                    <div class="rank-top">${card.rank}</div>
                    <div class="suit">${suit}</div>
                    <div class="rank-bottom">${card.rank}</div>
                `;
            }
            return cardEl;
        }

        /**
         * Calculates the score of a given hand, adjusting for Aces
         */
        function calculateScore(hand) {
            let score = 0;
            let aceCount = 0;
            for (const card of hand) {
                score += card.value;
                if (card.rank === 'A') aceCount++;
            }
            while (score > 21 && aceCount > 0) {
                score -= 10;
                aceCount--;
            }
            return [score, aceCount];
        }
        
        /**
         * Reveals the dealer's hidden card and full score
         */
        function revealDealerHand() {
            dealerHandEl.innerHTML = '';
            dealerHand.forEach(card => {
                dealerHandEl.appendChild(createCardElement(card, false));
            });
            [dealerScore, dealerAces] = calculateScore(dealerHand);
            dealerScoreEl.textContent = dealerScore;
        }

        /**
         * Handles the player's "Hit" action
         */
        function playerHit() {
            if (!gameInProgress) return;

            playerHand.push(dealCard());
            playerHandEl.appendChild(createCardElement(playerHand[playerHand.length - 1], false));
            
            [playerScore, playerAces] = calculateScore(playerHand);
            playerScoreEl.textContent = playerScore;

            if (playerScore > 21) {
                gameMessageEl.textContent = 'Bust! You lose.';
                endRound();
            }
        }

        /**
         * Handles the player's "Stand" action
         */
        function playerStand() {
            if (!gameInProgress) return;
            endRound(); // End player's turn and proceed to dealer
        }
        
        /**
         * Ends the player's turn, triggering the dealer's turn and determining the winner
         */
        function endRound() {
            gameInProgress = false;
            btnHit.disabled = true;
            btnStand.disabled = true;

            revealDealerHand();
            
            // Dealer hits until score is 17 or higher
            while (dealerScore < 17) {
                dealerHand.push(dealCard());
                dealerHandEl.appendChild(createCardElement(dealerHand[dealerHand.length - 1], false));
                [dealerScore, dealerAces] = calculateScore(dealerHand);
                dealerScoreEl.textContent = dealerScore;
            }

            determineWinner();
        }

        /**
         * Compares scores and declares a winner
         */
        function determineWinner() {
            if (playerScore > 21) {
                // Player already busted, message set in playerHit()
            } else if (dealerScore > 21) {
                gameMessageEl.textContent = 'Dealer busts! You win!';
                playerMoney += currentBet * 2; // Bet + 1:1 winnings
            } else if (playerScore > dealerScore) {
                gameMessageEl.textContent = 'You win!';
                playerMoney += currentBet * 2;
            } else if (dealerScore > playerScore) {
                gameMessageEl.textContent = 'You lose!';
                // Money already lost
            } else {
                gameMessageEl.textContent = 'Push (Tie)!';
                playerMoney += currentBet; // Return bet
            }
            
            // Schedule the reset for the next round
            setTimeout(resetForBetting, 2500);
        }
        
        /**
         * Updates the money display on the screen
         */
        function updateMoneyDisplay() {
            playerMoneyEl.textContent = playerMoney;
        }

    </script>
</body>
</html>
